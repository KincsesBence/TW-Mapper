/*! For license information please see bundle.js.LICENSE.txt */(()=>{"use strict";var e={"./src/core/Language.ts":(e,n,i)=>{i.r(n),i.d(n,{Lang:()=>r,determineLang:()=>a});var t=i("./src/view/language/en.ts"),o=i("./src/view/language/hu.ts");function r(e){let n=o.hu;switch(window.Lang){case"hu":n=o.hu;break;case"en":n=t.en}return n.hasOwnProperty(e)?n[e]:`lang.${window.Lang}.${e}`}function a(){const e=navigator.language.split("-")[0];return["hu","en"].includes(e)?e:"en"}},"./src/core/Vec2d.ts":(e,n,i)=>{i.r(n),i.d(n,{Vec2d:()=>t});class t{constructor(e,n){this.x=e,this.y=n}rotateMatrix(e,n=null){let i=this;if(0==(e%=360))return i;null!=n&&(i=i.base(n));let o=Math.PI/180*e,r=Math.cos(o),a=Math.sin(o),l=a*i.y+r*i.x,s=r*i.y-a*i.x,d=new t(l,s);return null!=n&&(d=d.rebase(n)),d}getDistance(e){return this.base(e).mag()}base(e){return new t(e.x-this.x,e.y-this.y)}rebase(e){return new t(e.x+this.x,e.y+this.y)}dotProduct(e){return this.x*e.x+this.y*e.y}angle(e){return Math.acos(this.dotProduct(e)/(this.mag()*e.mag()))*(180/Math.PI)}crossProduct(e){return e.x*this.y-e.y*this.x}mult(e){return new t(this.x*e,this.y*e)}normal(){return new t(-1*this.y,this.x).unit()}unit(){return 0===this.mag()?new t(0,0):new t(this.x/this.mag(),this.y/this.mag())}mag(){return Math.sqrt(this.x**2+this.y**2)}add(e){return new t(this.x+e.x,this.y+e.y)}subtr(e){return new t(this.x-e.x,this.y-e.y)}equal(e){return this.x==e.x&&this.y==e.y}}},"./src/core/api.ts":(e,n,i)=>{i.r(n),i.d(n,{getLastUpdate:()=>g,getServerConfig:()=>d,getTravelTime:()=>x,getUnitConfig:()=>c,redirect:()=>v,update:()=>h,updateWorldData:()=>m});var t=i("./src/view/loadingWindow.ts"),o=i("./src/core/Language.ts"),r=i("./src/core/xml2json.ts");const a="https://"+window.location.hostname,l="/interface.php?func=get_unit_info",s="/interface.php?func=get_config";async function d(){let e,n=localStorage.getItem("get_config");if(null==n){let n=await $.ajax({url:a+s});e=(0,r.xml2json)(n,""),localStorage.setItem("get_config",JSON.stringify(e))}else e=JSON.parse(n);return e}async function c(){let e,n=localStorage.getItem("get_unit_info");if(null==n){let n=await $.ajax({url:a+l});e=(0,r.xml2json)(n,""),localStorage.setItem("get_unit_info",JSON.stringify(e))}else e=JSON.parse(n);return e}async function w(e,n,i){console.log("started "+n);let t=e.trim().split("\n");await p(t,0,n,i),console.log("finished outer"+n)}async function p(e,n,i,t){return new Promise((async(r,a)=>{let l=function(e,n){let i=e.split(","),t={};return i.forEach(((e,i)=>{let o=decodeURIComponent(e).replaceAll("+"," ");isNaN(o)||(o=parseInt(o)),t[n[i]]=o})),t}(e[n],t);await window.DB.setData(i,l);let s=Math.ceil((n+1)/e.length*100);$("html").find(".mapper-loader-label").text(`${s}%`),$("html").find("#mapper-loader-pct").css("width",`${s}%`),$("html").find("#mapper-loading span").text(`${(0,o.Lang)(i)} ${(0,o.Lang)("loading")}...`),++n<e.length&&await p(e,n,i,t),r("done")}))}function g(){return new Date(parseInt(localStorage.getItem("TW_API_LAST_UPDATE"))-864e5).toLocaleString(`${window.Lang}-${window.Lang.toUpperCase()}`)}function u(e){return $.ajax({url:e,type:"GET"})}async function m(){parseInt(localStorage.getItem("TW_API_LAST_UPDATE"))>(new Date).getTime()||await h()}async function h(){console.log("Updating..."),window.Dialog.show("launchDialog",(0,t.loadingWindow)()),$(".popup_box_close").hide(),$(".popup_box_container").append('<div style="position: fixed;width: 100%;height: 100%;top:0;left:0;z-index:12001"></div>');let e=await u(`${a}/map/village.txt`),n=await u(`${a}/map/player.txt`),i=await u(`${a}/map/ally.txt`);await w(e,"villages",["id","name","x","y","player","points","rank"]),await f(1e3),await w(n,"players",["id","name","ally","villages","points","rank"]),await f(1e3),await w(i,"allies",["id","name","tag","members","villages","points","all_points","rank"]),await f(1e3),localStorage.setItem("TW_API_LAST_UPDATE",new Date((new Date).setDate((new Date).getDate()+1)).getTime().toString()),$("html").find("#mapper-loading span").text((0,o.Lang)("api_updated")),await f(2e3),window.Dialog.close("launchDialog"),console.log("Update finished")}async function f(e){return new Promise((async(n,i)=>{setTimeout((()=>{n()}),e)}))}function v(){return!window.location.href.includes("screen=map")&&(window.top.UI.InfoMessage((0,o.Lang)("redirect_to_map")),setTimeout((()=>{window.location.href=`game.php?village=${window.game_data.village.id}&screen=map`}),1e3),!0)}function x(e,n){let i=window.unitConfig[n].speed,t=Math.round(1e3*i/window.gameConfig.speed/window.gameConfig.unit_speed*e),o=Math.floor(t/6e4);t-=6e4*o;let r=Math.floor(t/1e3);t-=1e3*r;let a=Math.floor(t/16.5);return`${o.toString().padStart(1,"0")}:${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}},"./src/core/indexedDBHandler.ts":(e,n,i)=>{i.r(n),i.d(n,{indexedDBHandler:()=>t});class t{constructor(e,n,i,t){this.db=e,this.dbName=n,this.stores=i,this.version=t,console.log(`loaded ${this.dbName} DB ðŸš€`)}static async init(e,n,i){return new Promise(((o,r)=>{let a=indexedDB.open(e,i);a.onupgradeneeded=()=>{n.forEach((e=>{a.result.objectStoreNames.contains(e.keyName)||a.result.createObjectStore(e.name,{keyPath:e.keyName,autoIncrement:e.AI})})),a.onsuccess=()=>{o(new t(a.result,e,n,i))}},a.onsuccess=()=>{o(new t(a.result,e,n,i))},a.onerror=()=>{throw console.error("Error",a.error),new Error(a.error.message)}}))}getTransaction(e){let n=this.stores.findIndex((n=>n.name==e));return-1==n?null:(this.stores[n].transaction||(this.stores[n].transaction=this.db.transaction(e,"readwrite")),this.stores[n].transaction)}async getAllData(e){return new Promise((async(n,i)=>{if(!this.db.objectStoreNames.contains(e))return void n([]);let t=this.getTransaction(e),o=await t.objectStore(e).getAll();o.onsuccess=()=>{n(o.result)}}))}async getData(e,n){return new Promise((async(i,t)=>{if(!this.db.objectStoreNames.contains(e))return void i(null);let o=this.getTransaction(e),r=await o.objectStore(e).get(n);r.onsuccess=()=>{r.result?i(r.result):i(null)}}))}async setData(e,n){return new Promise((async(i,t)=>{if(!this.db.objectStoreNames.contains(e))return void i(null);let o=this.getTransaction(e),r=await o.objectStore(e).put(n);r.onsuccess=()=>{i(r.result)}}))}async removeData(e,n){return new Promise((async(i,t)=>{if(!this.db.objectStoreNames.contains(e))return void i(null);let o=this.getTransaction(e),r=await o.objectStore(e).delete(n);r.onsuccess=()=>{i(r.result)}}))}}},"./src/core/map.ts":(e,n,i)=>{i.r(n),i.d(n,{initMap:()=>c,mapAction:()=>d,render:()=>p});var t=i("./src/core/Vec2d.ts"),o=i("./src/core/api.ts");const r=38,a=53,l=5,s=5,d=function(e){var n=this.coordByEvent(e);if(!window.canDraw)return!1;switch(window.mapMenu.selectedTool){case"circle":!function(e){let n=window.markers.findIndex((e=>e.id==window.activeMarker));if(-1==n)window.activeMarker=(new Date).getTime(),window.markers.push({id:window.activeMarker,type:"circle",points:[e],canClose:!1,color:window.activeGroup?window.activeGroup.color:"#e66465",villages:[]});else if(window.markers[n].points.push(e),2==window.markers[n].points.length){let e=window.markers[n].points[0].getDistance(window.markers[n].points[1]);window.activeMarker=window.markers[n].id,window.markers[n].length=e,window.markers[n].canClose=!0,window.markers[n].villages=function(e,n){let i=window.villages,o=[];return i.forEach((i=>{n.getDistance(new t.Vec2d(i.x,i.y))<=e&&o.push(i)})),o}(e,window.markers[n].points[0]),window.activeMarker=null}p()}(new t.Vec2d(n[0],n[1]));break;case"concave":!async function(e){let n=window.markers.findIndex((e=>e.id==window.activeMarker));-1==n?(window.activeMarker=(new Date).getTime(),window.markers.push({id:window.activeMarker,type:"concave",points:[e],canClose:!1,color:window.activeGroup?window.activeGroup.color:"#e66465",villages:[]}),p()):(window.markers[n].points[window.markers[n].points.length-1].equal(e)?window.markers[n].points.splice(window.markers[n].points.length-1,1):window.markers[n].points[0].equal(e)?(window.activeMarker=window.markers[n].id,window.markers[n].canClose=!0,window.activeMarker=null,window.markers[n].villages=function(e){let n=1/0,i=-1/0,o=1/0,r=-1/0;e.forEach((e=>{e.x>i&&(i=e.x),e.y>r&&(r=e.y),e.x<n&&(n=e.x),e.y<o&&(o=e.y)}));let a=window.villages,l=[];a.forEach((e=>{e.x>=n&&e.x<=i&&e.y>=o&&e.y<=r&&l.push(e)}));let s=[];l.forEach((n=>{let i=!1;(function(e,n){for(var i=n.x,t=n.y,o=!1,r=0,a=e.length-1;r<e.length;a=r++){var l=e[r].x,s=e[r].y,d=e[a].x,c=e[a].y;s>t!=c>t&&i<(d-l)*(t-s)/(c-s)+l&&(o=!o)}return o})(e,new t.Vec2d(n.x,n.y))&&(i=!0);for(let o=0;o<e.length-1;o++)f(e[o],new t.Vec2d(n.x,n.y),e[o+1],.2)&&(i=!0);f(e[0],new t.Vec2d(n.x,n.y),e[e.length-1],.2)&&(i=!0),i&&s.push(n)})),p();let d="";return s.forEach((e=>{d+="','"+e.x+"|"+e.y})),s}(window.markers[n].points)):window.markers[n].points.push(e),p())}(new t.Vec2d(n[0],n[1]));break;case"rectangle":!function(e){let n=window.markers.findIndex((e=>e.id==window.activeMarker));-1==n?(window.activeMarker=(new Date).getTime(),window.markers.push({id:window.activeMarker,type:"rectangle",points:[e],canClose:!1,color:window.activeGroup?window.activeGroup.color:"#e66465",villages:[]})):(window.markers[n].points.push(e),2==window.markers[n].points.length&&(window.activeMarker=window.markers[n].id,window.markers[n].canClose=!0,window.markers[n].villages=m([...window.markers[n].points]),window.activeMarker=null)),p()}(new t.Vec2d(n[0],n[1]));break;case"single":!async function(e){let n=m([e,e]),i=window.markers.findIndex((e=>e.villages[0].id==n[0].id));-1==i?(window.activeMarker=(new Date).getTime(),window.markers.push({id:window.activeMarker,type:"single",points:[e],villages:n,color:window.activeGroup?window.activeGroup.color:"#e66465",canClose:!1}),window.activeMarker=null):window.markers.splice(i,1),p()}(new t.Vec2d(n[0],n[1]));break;case"kontinent":!async function(e){let n=100*Math.floor(e.x/100),i=100*Math.floor(e.y/100),o=new t.Vec2d(n,i),r=o.add(new t.Vec2d(99,99)),a=m([r,o]),l=window.markers.findIndex((e=>{if(e.villages.length>0)return e.villages[0].id==a[0].id}));-1==l?(window.activeMarker=(new Date).getTime(),window.markers.push({id:window.activeMarker,type:"kontinent",points:[r,o],villages:a,color:window.activeGroup?window.activeGroup.color:"#e66465",canClose:!0}),window.activeMarker=null):window.markers.splice(l,1),p()}(new t.Vec2d(n[0],n[1]));break;case"tape":!function(e){let n=window.markers.findIndex((e=>"tape"==e.type&&e.canClose));if(n>-1&&window.markers.splice(n,1),n=window.markers.findIndex((e=>e.id==window.activeMarker)),-1==n)window.activeMarker=(new Date).getTime(),window.markers.push({id:window.activeMarker,type:"tape",points:[e],canClose:!1,color:window.activeGroup?window.activeGroup.color:"#e66465",villages:[]});else if(window.markers[n].points.push(e),2==window.markers[n].points.length){let e=window.markers[n].points[0].getDistance(window.markers[n].points[1]);window.activeMarker=window.markers[n].id,window.markers[n].length=e,window.markers[n].canClose=!0,window.markers[n].villages=[],window.activeMarker=null}p()}(new t.Vec2d(n[0],n[1]))}return!1};function c(){$("#minimap_mover").append('<canvas id="mini_map" />'),$("#map_mover").append('<canvas id="big_map" />'),$('[onclick*="VillageInfo.Notes.toggleEdit()"]').removeAttr("onclick");let e=document.getElementById("mini_map");window.ctxMini=e.getContext("2d");let n=document.getElementById("big_map");window.ctxBig=n.getContext("2d"),window.ctxBig.canvas.width=$("#map_mover").innerWidth(),window.ctxBig.canvas.height=$("#map_mover").innerHeight(),window.ctxMini.canvas.width=$("#minimap_mover").innerWidth(),window.ctxMini.canvas.height=$("#minimap_mover").innerHeight(),window.ctxBig.save(),window.ctxMini.save(),w(),p(),new MutationObserver(u).observe(document.querySelector("#map_container"),{attributes:!0})}function w(){let e=parseFloat($("#map_coord_x").css("left").replace("px","")),n=parseFloat($("#map_coord_y").css("top").replace("px","")),i=parseFloat($("#minimap_container").css("left").replace("px","")),o=parseFloat($("#minimap_container").css("top").replace("px",""));window.translateBig=new t.Vec2d(26500,26500).subtr(new t.Vec2d(e,n)),window.translateMini=new t.Vec2d(-i,-o)}function p(){window.ctxBig.canvas.width=$("#map_mover").innerWidth(),window.ctxBig.canvas.height=$("#map_mover").innerHeight(),window.ctxMini.canvas.width=$("#minimap_mover").innerWidth(),window.ctxMini.canvas.height=$("#minimap_mover").innerHeight(),window.ctxBig.clearRect(0,0,window.ctxBig.canvas.width,window.ctxBig.canvas.height),window.ctxMini.clearRect(0,0,window.ctxMini.canvas.width,window.ctxMini.canvas.height),window.ctxMini.reset(),window.ctxMini.translate(-window.translateMini.x,-window.translateMini.y),window.ctxBig.reset(),window.ctxBig.translate(-window.translateBig.x,-window.translateBig.y),window.markers.forEach((e=>{switch(window.ctxMini.strokeStyle=e.color,window.ctxBig.strokeStyle=e.color,window.ctxMini.fillStyle=e.color+"80",window.ctxBig.fillStyle=e.color+"80",window.ctxMini.lineWidth=2,window.ctxBig.lineWidth=5,e.type){case"circle":!function(e){e.points.length>=1&&(window.ctxBig.beginPath(),window.ctxBig.ellipse((e.points[0].x+1)*a-a/2,(e.points[0].y+1)*r-r/2,a/2*.5,r/2*.5,0,0,2*Math.PI),window.ctxBig.fill(),window.ctxBig.closePath()),2==e.points.length&&(window.ctxBig.beginPath(),window.ctxBig.setLineDash([5,15]),window.ctxBig.moveTo((e.points[0].x+1)*a-a/2,(e.points[0].y+1)*r-r/2),window.ctxBig.lineTo((e.points[1].x+1)*a-a/2,(e.points[1].y+1)*r-r/2),window.ctxBig.stroke(),window.ctxBig.closePath()),e.canClose&&(window.ctxBig.beginPath(),window.ctxMini.beginPath(),window.ctxBig.setLineDash([]),window.ctxBig.ellipse((e.points[0].x+1)*a-a/2,(e.points[0].y+1)*r-r/2,a/2*e.length*2,r/2*e.length*2,0,0,2*Math.PI),window.ctxBig.stroke(),window.ctxMini.ellipse((e.points[0].x+1)*s-s/2,(e.points[0].y+1)*l-l/2,s/2*e.length*2,l/2*e.length*2,0,0,2*Math.PI),window.ctxMini.stroke(),window.ctxBig.closePath(),window.ctxMini.closePath())}(e);break;case"concave":!function(e){window.ctxBig.beginPath(),e.points.length>0&&(window.ctxBig.ellipse((e.points[0].x+1)*a-a/2,(e.points[0].y+1)*r-r/2,a/2*.6,r/2*.6,0,0,2*Math.PI),window.ctxBig.fill());for(let n=0;n<e.points.length-1;n++)g(e.points[n],e.points[n+1]),window.ctxBig.ellipse((e.points[n+1].x+1)*a-a/2,(e.points[n+1].y+1)*r-r/2,a/2*.25,r/2*.25,0,0,2*Math.PI),window.ctxMini.fill();e.canClose&&g(e.points[0],e.points[e.points.length-1]),window.ctxMini.stroke(),window.ctxBig.stroke()}(e);break;case"rectangle":!function(e){if(e.points.length>=1&&(window.ctxBig.beginPath(),window.ctxBig.ellipse((e.points[0].x+1)*a-a/2,(e.points[0].y+1)*r-r/2,a/2*.5,r/2*.5,0,0,2*Math.PI),window.ctxBig.fill(),window.ctxBig.closePath()),2==e.points.length&&(window.ctxBig.beginPath(),window.ctxBig.setLineDash([5,15]),window.ctxBig.moveTo((e.points[0].x+1)*a-a/2,(e.points[0].y+1)*r-r/2),window.ctxBig.lineTo((e.points[1].x+1)*a-a/2,(e.points[1].y+1)*r-r/2),window.ctxBig.stroke(),window.ctxBig.closePath()),e.canClose){window.ctxBig.beginPath(),window.ctxMini.beginPath(),window.ctxBig.setLineDash([]);let n=e.points[0],i=e.points[1].subtr(n);i.x<0&&i.y<0?(n=n.add(new t.Vec2d(1,1)),i=i.subtr(new t.Vec2d(1,1))):i.x>=0&&i.y>=0?i=i.add(new t.Vec2d(1,1)):i.x<0&&i.y>=0?(n=n.add(new t.Vec2d(1,0)),i=i.subtr(new t.Vec2d(1,-1))):i.x>=0&&i.y<0&&(n=n.add(new t.Vec2d(0,1)),i=i.subtr(new t.Vec2d(-1,1))),window.ctxBig.rect(n.x*a,n.y*r,i.x*a,i.y*r),window.ctxBig.stroke(),window.ctxMini.rect(n.x*s,n.y*l,i.x*s,i.y*l),window.ctxMini.stroke(),window.ctxBig.closePath(),window.ctxMini.closePath()}}(e);break;case"kontinent":!function(e){window.ctxBig.beginPath(),window.ctxMini.beginPath(),window.ctxBig.setLineDash([]);let n=e.points[0].subtr(e.points[1]);window.ctxBig.rect(e.points[1].x*a,e.points[1].y*r,(n.x+1)*a,(n.y+1)*r),window.ctxBig.stroke(),window.ctxMini.rect(e.points[1].x*s,e.points[1].y*l,(n.x+1)*s,(n.y+1)*l),window.ctxMini.stroke(),window.ctxBig.closePath(),window.ctxMini.closePath()}(e);break;case"tape":!function(e){e.points.length>=1&&(window.ctxBig.beginPath(),window.ctxBig.ellipse((e.points[0].x+1)*a-a/2,(e.points[0].y+1)*r-r/2,a/2*.5,r/2*.5,0,0,2*Math.PI),window.ctxBig.fill(),window.ctxBig.setLineDash([]),window.ctxBig.stroke(),window.ctxBig.closePath()),2==e.points.length&&(window.ctxBig.beginPath(),window.ctxBig.setLineDash([5,10]),window.ctxBig.moveTo((e.points[0].x+1)*a-a/2,(e.points[0].y+1)*r-r/2),window.ctxBig.lineTo((e.points[1].x+1)*a-a/2,(e.points[1].y+1)*r-r/2),window.ctxBig.stroke(),window.ctxBig.closePath(),window.ctxBig.beginPath(),window.ctxBig.setLineDash([]),window.ctxBig.ellipse((e.points[1].x+1)*a-a/2,(e.points[1].y+1)*r-r/2,a/2*.5,r/2*.5,0,0,2*Math.PI),window.ctxBig.stroke(),window.ctxBig.fill(),window.ctxBig.closePath(),window.ctxMini.beginPath(),window.ctxMini.moveTo((e.points[0].x+1)*s-s/2,(e.points[0].y+1)*l-l/2),window.ctxMini.lineTo((e.points[1].x+1)*s-s/2,(e.points[1].y+1)*l-l/2),window.ctxMini.stroke(),window.ctxMini.closePath()),e.canClose&&window.game_data.units.forEach(((n,i)=>{let t=(0,o.getTravelTime)(e.length,n);window.ctxBig.fillStyle=i%2==0?"#f8f4e8":"#ded3b9",window.ctxBig.fillRect(e.points[1].x*a+8*t.length*i,e.points[1].y*r-46,8*t.length,48),window.ctxBig.fillStyle="black",window.ctxBig.font="16px serif";let l=new Image;l.src=`https://dshu.innogamescdn.com/asset/708c3ff7/graphic/unit/unit_${n}.png`,window.ctxBig.drawImage(l,e.points[1].x*a+8*t.length*i+8*t.length/2-8,e.points[1].y*r-40),window.ctxBig.fillText(t,e.points[1].x*a+8*t.length*i+3,e.points[1].y*r-2)}))}(e)}void 0!==e.villages&&e.villages.forEach((n=>{window.ctxBig.fillStyle=e.color+"66",window.ctxBig.fillRect((n.x+1)*a-a,(n.y+1)*r-r,a,r),window.ctxMini.fillStyle=e.color,window.ctxMini.fillRect((n.x+1)*s-s,(n.y+1)*l-l,s,l)}))})),window.groups.forEach((e=>{e.villages.forEach((n=>{window.ctxBig.fillStyle=e.color+"66",window.ctxBig.fillRect((n.x+1)*a-a,(n.y+1)*r-r,a,r),window.ctxMini.fillStyle=e.color,window.ctxMini.fillRect((n.x+1)*s-s,(n.y+1)*l-l,s,l)}))}))}function g(e,n){window.ctxBig.moveTo((e.x+1)*a-a/2,(e.y+1)*r-r/2),window.ctxBig.lineTo((n.x+1)*a-a/2,(n.y+1)*r-r/2),window.ctxMini.moveTo((e.x+1)*s-s/2,(e.y+1)*l-l/2),window.ctxMini.lineTo((n.x+1)*s-s/2,(n.y+1)*l-l/2)}function u(){w(),p()}function m(e){let n=window.villages,i=[];if(2!=e.length)return[];let o=[e[0],new t.Vec2d(e[0].x,e[1].y),e[1],new t.Vec2d(e[1].x,e[0].y)],r=new t.Vec2d(1,0),a=new t.Vec2d(0,1),[l,s]=h(r,o),[d,c]=h(a,o);return n.forEach((e=>{let[n,o]=h(r,[new t.Vec2d(e.x,e.y)]),[w,p]=h(a,[new t.Vec2d(e.x,e.y)]);n<=l&&o>=s&&w<=d&&p>=c&&i.push(e)})),i}function h(e,n){let i=[];for(let t=0;t<n.length;t++)i.push(e.dotProduct(n[t]));return[Math.max(...i),Math.min(...i)]}function f(e,n,i,t){var o=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y);if(0==o)return!1;var r=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;if(r<0)return e.getDistance(n)<=t;if(0<=r&&r<=1){var a=((e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y))/o;return Math.abs(a)*Math.sqrt(o)<=t}return e.getDistance(n)<=t}document.addEventListener("keydown",(e=>{"Shift"===e.key&&(window.canDraw=!0)})),document.addEventListener("keyup",(e=>{"Shift"===e.key&&(window.canDraw=!1)}))},"./src/core/xml2json.ts":(e,n,i)=>{function t(e,n){var i={toObj:function(e){var n={};if(1==e.nodeType){if(e.attributes.length)for(var t=0;t<e.attributes.length;t++)n["@"+e.attributes[t].nodeName]=(e.attributes[t].nodeValue||"").toString();if(e.firstChild){for(var o=0,r=0,a=!1,l=e.firstChild;l;l=l.nextSibling)1==l.nodeType?a=!0:3==l.nodeType&&l.nodeValue.match(/[^ \f\n\r\t\v]/)?o++:4==l.nodeType&&r++;if(a)if(o<2&&r<2)for(i.removeWhite(e),l=e.firstChild;l;l=l.nextSibling)3==l.nodeType?n["#text"]=i.escape(l.nodeValue):4==l.nodeType?n["#cdata"]=i.escape(l.nodeValue):n[l.nodeName]?n[l.nodeName]instanceof Array?n[l.nodeName][n[l.nodeName].length]=i.toObj(l):n[l.nodeName]=[n[l.nodeName],i.toObj(l)]:n[l.nodeName]=i.toObj(l);else e.attributes.length?n["#text"]=i.escape(i.innerXml(e)):n=i.escape(i.innerXml(e));else if(o)e.attributes.length?n["#text"]=i.escape(i.innerXml(e)):(n=i.escape(i.innerXml(e)),isNaN(n)||(n=parseFloat(n)));else if(r)if(r>1)n=i.escape(i.innerXml(e));else for(l=e.firstChild;l;l=l.nextSibling)n["#cdata"]=i.escape(l.nodeValue)}e.attributes.length||e.firstChild||(n=null)}else 9==e.nodeType?n=i.toObj(e.documentElement):alert("unhandled node type: "+e.nodeType);return n},toJson:function(e,n,t){var o=n?'"'+n+'"':"";if(e instanceof Array){for(var r=0,a=e.length;r<a;r++)e[r]=i.toJson(e[r],"",t+"\t");o+=(n?":[":"[")+(e.length>1?"\n"+t+"\t"+e.join(",\n"+t+"\t")+"\n"+t:e.join(""))+"]"}else if(null==e)o+=(n&&":")+"null";else if("object"==typeof e){var l=[];for(var s in e)l[l.length]=i.toJson(e[s],s,t+"\t");o+=(n?":{":"{")+(l.length>1?"\n"+t+"\t"+l.join(",\n"+t+"\t")+"\n"+t:l.join(""))+"}"}else o+="string"==typeof e?(n&&":")+'"'+e.toString()+'"':(n&&":")+e.toString();return o},innerXml:function(e){var n="";if("innerHTML"in e)n=e.innerHTML;else for(var i=function(e){var n="";if(1==e.nodeType){n+="<"+e.nodeName;for(var t=0;t<e.attributes.length;t++)n+=" "+e.attributes[t].nodeName+'="'+(e.attributes[t].nodeValue||"").toString()+'"';if(e.firstChild){n+=">";for(var o=e.firstChild;o;o=o.nextSibling)n+=i(o);n+="</"+e.nodeName+">"}else n+="/>"}else 3==e.nodeType?n+=e.nodeValue:4==e.nodeType&&(n+="<![CDATA["+e.nodeValue+"]]>");return n},t=e.firstChild;t;t=t.nextSibling)n+=i(t);return n},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var n=e.firstChild;n;)if(3==n.nodeType)if(n.nodeValue.match(/[^ \f\n\r\t\v]/))n=n.nextSibling;else{var t=n.nextSibling;e.removeChild(n),n=t}else 1==n.nodeType?(i.removeWhite(n),n=n.nextSibling):n=n.nextSibling;return e}};return 9==e.nodeType&&(e=e.documentElement),i.toObj(i.removeWhite(e))}i.r(n),i.d(n,{xml2json:()=>t})},"./src/img/circle.ts":(e,n,i)=>{function t(){return'\n <svg width="25"\n height="25"\n viewBox="0 0 26.458333 26.458334">\n <circle\n style="opacity:1;fill:none;stroke:#6c4824;stroke-width:2.365;fill-opacity:1;stroke-opacity:1"\n id="path848"\n cx="13.229167"\n cy="13.229167"\n r="11.347473" />\n </svg>\n '}i.r(n),i.d(n,{circle:()=>t})},"./src/img/kontinent.ts":(e,n,i)=>{function t(){return'\n <svg width="25"\n height="25"\n viewBox="0 0 26.458333 26.458334">\n <text\n xml:space="preserve"\n style="font-style:normal;font-weight:normal;font-size:22.3015px;line-height:1.25;font-family:sans-serif;fill:#6c4824;fill-opacity:1;stroke:none;stroke-width:0.232307"\n x="5.0529065"\n y="20.811829"\n id="text9912"\n transform="scale(0.9603528,1.041284)"><tspan\n sodipodi:role="line"\n id="tspan9910"\n style="font-size:22.3015px;stroke-width:0.232307;fill:#6c4824;fill-opacity:1"\n x="5.0529065"\n y="20.811829">K</tspan></text>\n <rect\n style="fill:none;stroke:#6c4824;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:6.00000017,2.00000006;stroke-dashoffset:0"\n id="rect13536"\n width="21.801445"\n height="21.801445"\n x="2.3284442"\n y="2.3284442"\n ry="0.82648951" />\n </svg>\n'}i.r(n),i.d(n,{kontinent:()=>t})},"./src/img/line.ts":(e,n,i)=>{function t(){return'\n <svg width="25"\n height="25"\n viewBox="0 0 26.458333 26.458334">\n <circle\n style="opacity:1;fill:none;fill-opacity:1;stroke:#6c4824;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n id="path6255"\n cx="4.6238723"\n cy="4.6238718"\n r="4" />\n <circle\n style="fill:none;fill-opacity:1;stroke:#6c4824;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n id="path6255-3"\n cx="21.935469"\n cy="21.890795"\n r="4" />\n <rect\n style="opacity:1;fill:#6c4824;fill-opacity:1;stroke:none;stroke-width:1.5;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n id="rect6483"\n width="1.8512045"\n height="25.774113"\n x="-0.48315775"\n y="5.8062401"\n ry="0.92407191"\n transform="matrix(0.73956041,-0.67309019,0.69019138,0.72362687,0,0)" />\n </svg>\n '}i.r(n),i.d(n,{line:()=>t})},"./src/img/rectangle.ts":(e,n,i)=>{function t(){return'\n <svg width="25"\n height="25"\n viewBox="0 0 26.458333 26.458334">\n <rect\n style="opacity:1;fill:none;fill-opacity:1;stroke:#6c4824;stroke-width:2.365;stroke-opacity:1"\n id="rect4951"\n width="22.158844"\n height="21.846119"\n x="2.1497447"\n y="2.3061073" />\n </svg>\n'}i.r(n),i.d(n,{rectangle:()=>t})},"./src/img/single.ts":(e,n,i)=>{function t(){return'\n <svg width="25"\n height="25"\n viewBox="0 0 26.458333 26.458334">\n <path\n style="fill:none;stroke:#6c4824;stroke-width:2px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;fill-opacity:1"\n d="M 2.2174779,1.0042411 V 15.679964 L 8.6041772,11.460693 17.728033,25.402632 24.570925,21.366806 12.481815,9.2593345 17.499936,5.9572972 Z"\n id="path11483" />\n </svg>\n'}i.r(n),i.d(n,{single:()=>t})},"./src/img/tape.ts":(e,n,i)=>{function t(){return'\n <svg width="25"\n height="25"\n viewBox="0 0 26.458333 26.458334">\n <path\n id="path15664"\n style="fill:none;fill-opacity:1;stroke:#6c4824;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"\n d="m 3.6509501,11.328717 c -1.9535173,2.511818 -2.67871088,6.073186 -1.8681182,6.639987 l 7.6530813,5.805014 7.1447008,-9.272191 -0.587741,-0.463325 8.03692,-10.5399487 0.727482,0.5381894 0.3553,-0.4316423 -2.069155,-1.5416048 -8.322045,10.9722824 -1.35904,-1.535475 0.626117,-1.7121804 -1.459553,-1.1071 -1.666541,0.866568 C 7.731817,7.8865856 5.2695789,9.2474976 3.6509501,11.328717 Z" />\n <circle\n style="fill:none;fill-opacity:1;stroke:#6c4824;stroke-width:2;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"\n id="path17705"\n cx="-7.1404595"\n cy="15.965486"\n r="3.0"\n transform="rotate(-52.818961)" />\n </svg>\n '}i.r(n),i.d(n,{tape:()=>t})},"./src/view/filterWindow.ts":(e,n,i)=>{i.r(n),i.d(n,{filterWindow:()=>r});var t=i("./src/core/Language.ts"),o=i("./src/core/map.ts");function r(){return`\n <style>\n .filter-window{\n height:400px;\n width:500px;\n position:fixed;\n top: 0;\n bottom: 0;\n left: 0;\n right: 0;\n margin: auto;\n background: transparent url(https://dshu.innogamescdn.com/asset/fd86cac8/graphic/index/contentbg.png) scroll left top repeat;\n filter: drop-shadow(0 0 0.75rem rgb(88, 88, 88));\n border: 2px solid #6c4824;\n border-radius: 10px;\n display:grid;\n grid-template-rows: 1fr 3fr 25px; \n gap: 0px 0px;\n grid-template-areas: \n "filter-menu"\n "filter-items"\n "filter-footer"; \n padding:5px;\n row-gap:10px;\n background-color:#f4e4bc;\n }\n .filter-menu{\n display:grid;\n justify-content:center;\n grid-area: filter-menu;\n }\n .filter-sub{\n margin:10px auto;\n display:table;\n justify-content:center;\n grid-area: filter-sub;\n }\n .filter-footer{\n display:flex;\n justify-content:center;\n grid-area: filter-footer;\n }\n .filter-items{\n grid-area: filter-items;\n overflow-y: scroll;\n }\n\n .filter-sub select{\n max-width:150px;\n font-size:14px;\n }\n .filter-sub div{\n margin-bottom:5px;\n }\n .filter-sub div:first-of-type{\n display: flex;\n justify-content:center;\n }\n .filter-item{\n padding:5px;\n background-color: #fff5da;\n border-top: solid 1px #ebd7af;\n display:flex;\n justify-content:space-between;\n }\n .filter-mover{\n margin:3px 5px;\n width: 11px; \n height:11px; \n background-image: url(https://dshu.innogamescdn.com/asset/7fe7ab60/graphic/sorthandle.png); \n cursor:pointer\n }\n .filter-footer label{\n padding:5px\n }\n .filter-text{\n width: -webkit-fill-available;\n overflow: hidden;\n text-overflow: ellipsis;\n white-space: nowrap;\n }\n </style>\n <div class="filter-window" style="display:none;">\n <div class="filter-menu">\n <div class="filter-main">\n <button class="btn" onclick="filterWindow.barbMenu()">${(0,t.Lang)("barb")}</button>\n <button class="btn" onclick="filterWindow.playerMenu()">${(0,t.Lang)("player")}</button> \n <button class="btn" onclick="filterWindow.allyMenu()">${(0,t.Lang)("ally")}</button>\n <button class="btn" onclick="filterWindow.pointMenu()">${(0,t.Lang)("points")}</button>\n <button class="btn" onclick="filterWindow.bonusMenu()">${(0,t.Lang)("bonus")}</button> \n </div>\n <div class="filter-sub"></div>\n </div>\n <div class="filter-items"></div>\n <div class="filter-footer">\n <input id="copyCheck" type="checkbox"/><label>${(0,t.Lang)("carbon_copy")}</label>\n <button class="btn" onclick="filterWindow.applyFilter()">${(0,t.Lang)("apply")}</button>\n <button class="btn" onclick="filterWindow.cancelFilter()">${(0,t.Lang)("cancel")}</button> \n </div>\n </div>`}window.filterWindow={filters:[],cancelFilter(){$(".filter-window").hide(),window.filterWindow.filters=[],$(".group-items").find('input[type="checkbox"]').get().forEach((e=>{$(e).prop("disabled")&&$(e).prop("disabled",!1)}))},mainMenu(){$(".filter-main").show(),$(".filter-sub").hide()},barbMenu(){$(".filter-main").hide(),$(".filter-sub").html(`\n <div>\n <button onclick="filterWindow.addFilter('barbs','+')" class="btn">+ ${(0,t.Lang)("barb")}</button>\n <button onclick="filterWindow.addFilter('barbs','-')" class="btn">- ${(0,t.Lang)("barb")}</button>\n <button onclick="filterWindow.mainMenu()" class="btn">${(0,t.Lang)("cancel")}</button>\n </div>\n `),$(".filter-sub").show()},allyMenu(){let e=[];window.groupWindow.selectedGroups.forEach((n=>{let i=window.groups.findIndex((e=>e.id==n));-1!=i&&window.groups[i].villages.forEach((n=>{if(0!=n.player){let i=window.players.findIndex((e=>e.id==n.player));if(-1==i)return;let t=window.allies.findIndex((e=>window.players[i].ally==e.id));if(-1==t)return;-1==e.findIndex((e=>e.id==window.allies[t].id))&&e.push({id:window.allies[t].id,tag:window.allies[t].tag})}}))})),e.sort(((e,n)=>e.tag<n.tag?-1:1)),$(".filter-main").hide(),$(".filter-sub").html(`\n <div>\n <select id="filter-ally">\n ${e.map((e=>`<option value="${e.id}">${e.tag}</option>`)).join("")}\n </select>\n </div>\n <div>\n <button onclick="filterWindow.addFilter('ally','+')" class="btn">+ ${(0,t.Lang)("ally")}</button>\n <button onclick="filterWindow.addFilter('ally','-')" class="btn">- ${(0,t.Lang)("ally")}</button>\n <button onclick="filterWindow.mainMenu()" class="btn">${(0,t.Lang)("cancel")}</button>\n </div>\n `),$(".filter-sub").show()},playerMenu(){let e=[];window.groupWindow.selectedGroups.forEach((n=>{let i=window.groups.findIndex((e=>e.id==n));window.groups[i].villages.forEach((n=>{if(0!=n.player){let i=window.players.findIndex((e=>e.id==n.player));-1==e.findIndex((e=>e.id==window.players[i].id))&&e.push({id:window.players[i].id,name:window.players[i].name})}}))})),e.sort(((e,n)=>e.name<n.name?-1:1)),$(".filter-main").hide(),$(".filter-sub").html(`\n <div>\n <select id="filter-player">\n ${e.map((e=>`<option value="${e.id}">${e.name}</option>`)).join("")}\n </select>\n </div>\n <div>\n <button onclick="filterWindow.addFilter('player','+')" class="btn">+ ${(0,t.Lang)("player")}</button>\n <button onclick="filterWindow.addFilter('player','-')" class="btn">- ${(0,t.Lang)("player")}</button>\n <button onclick="filterWindow.mainMenu()" class="btn">${(0,t.Lang)("cancel")}</button>\n </div>\n `),$(".filter-sub").show()},bonusMenu(){$(".filter-main").hide(),$(".filter-sub").html(`\n <div>\n <select id="filter-bonus">\n <option value="-1">${(0,t.Lang)("only_barbs")}</option>\n <option value="0">${(0,t.Lang)("not_bonus")}</option>\n ${Object.keys(window.TWMap.bonus_data).map((e=>`<option value="${e}">${window.TWMap.bonus_data[e].text}</option>`)).join("")}\n </select>\n </div>\n <div>\n <button onclick="filterWindow.addFilter('bonus','+')" class="btn">+ ${(0,t.Lang)("bonus")}</button>\n <button onclick="filterWindow.addFilter('bonus','-')" class="btn">- ${(0,t.Lang)("bonus")}</button>\n <button onclick="filterWindow.mainMenu()" class="btn"> ${(0,t.Lang)("cancel")}</button>\n </div>\n `),$(".filter-sub").show()},pointMenu(){$(".filter-main").hide(),$(".filter-sub").html(`\n <div>\n <label>${(0,t.Lang)("village_points")}: </label>\n <select id="filter-points-select">\n <option value=">" selected="">&gt;</option>\n <option value="<">&lt;</option>\n <option value="=">=</option>\n <option value=">=">â‰¥</option>\n <option value="<=">â‰¤</option>\n <option value="!=">â‰ </option>\n </select>\n <input type="number" id="filter-points">\n </div>\n <div>\n <button onclick="filterWindow.addFilter('points','+')" class="btn">+ ${(0,t.Lang)("points")}</button>\n <button onclick="filterWindow.addFilter('points','-')" class="btn">- ${(0,t.Lang)("points")}</button>\n <button onclick="filterWindow.mainMenu()" class="btn">${(0,t.Lang)("cancel")}</button>\n <div>\n `),$(".filter-sub").show()},addFilter(e,n){let i;if("points"==e){if(""==$("html").find("#filter-points").val().toString().trim())return void window.UI.ErrorMessage((0,t.Lang)("filter_must_be_entered"));i={stmt:$("html").find("#filter-points-select").val().toString(),val:parseInt($("html").find("#filter-points").val().toString())}}else"player"==e?i={id:parseInt($("html").find("#filter-player").val().toString()),name:$("html").find("#filter-player option:selected").text()}:"ally"==e?i={id:parseInt($("html").find("#filter-ally").val().toString()),name:$("html").find("#filter-ally option:selected").text()}:"bonus"==e&&(i={id:parseInt($("html").find("#filter-bonus").val().toString()),name:$("html").find("#filter-bonus option:selected").text()});window.filterWindow.filters.push({type:e,op:n,val:i}),$(".filter-main").show(),$(".filter-sub").hide(),window.filterWindow.renderFilter()},renderFilter(){let e="";window.filterWindow.filters.forEach(((n,i)=>{let o="";switch(n.type){case"player":o=`${(0,t.Lang)("player")} ${"-"==n.op?(0,t.Lang)("remove_it"):(0,t.Lang)("add_it")}: ${n.val.name}`;break;case"ally":o=`${(0,t.Lang)("ally")} ${"-"==n.op?(0,t.Lang)("remove_it"):(0,t.Lang)("add_it")}: ${n.val.name}`;break;case"bonus":o=`${(0,t.Lang)("bonus")} ${"-"==n.op?(0,t.Lang)("remove_it"):(0,t.Lang)("add_it")}: ${n.val.name}`;break;case"barbs":o=`${(0,t.Lang)("barbs")} ${"-"==n.op?(0,t.Lang)("remove_it"):(0,t.Lang)("add_it")}`;break;case"points":o=`${"-"==n.op?(0,t.Lang)("remove"):(0,t.Lang)("add")} ${(0,t.Lang)("if_village_points")} ${n.val.stmt} ${n.val.val}`}e+=`\n <div id="fi-${i}" class="filter-item">\n <div class="qbhandle ui-sortable-handle filter-mover"></div>\n <span class="filter-text">${o}</span>\n <img onclick="filterWindow.removeFilter(${i})" src="https://dshu.innogamescdn.com/asset/7fe7ab60/graphic/delete.png" data-title="TÃ¶rlÃ©s">\n </div>`})),$(".filter-items").html(e),$(".filter-items").sortable({update:()=>{let e=[];$(".filter-items .filter-item").get().forEach((n=>{let i=parseInt($(n).attr("id").replace("fi-",""));e.push(window.filterWindow.filters[i])})),window.filterWindow.filters=e,window.filterWindow.renderFilter()}})},removeFilter(e){window.filterWindow.filters.splice(e,1),window.filterWindow.renderFilter()},applyFilter(){0!=window.groupWindow.selectedGroups.length?0!=window.filterWindow.filters.length?(window.groupWindow.selectedGroups.forEach((e=>{let n=window.groups.findIndex((n=>n.id==e)),i=[...window.groups[n].villages],t=[...window.groups[n].villages],o=!1;if(window.filterWindow.filters.forEach((e=>{switch("+"!=e.op||o?"-"==e.op&&(o=!1):(console.log("reset"),i=[...t],t=[],o=!0),e.type){case"player":t="+"==e.op?[...window.filterWindow.addPlayerFilter(e,i,t)]:[...window.filterWindow.removePlayerFilter(e,t)];break;case"ally":t="+"==e.op?[...window.filterWindow.addAllyFilter(e,i,t)]:[...window.filterWindow.removeAllyFilter(e,t)];break;case"bonus":t="+"==e.op?[...window.filterWindow.addBonusFilter(e,i,t)]:[...window.filterWindow.removeBonusFilter(e,t)];break;case"barbs":t="+"==e.op?[...window.filterWindow.addBarbsFilter(i,t)]:[...window.filterWindow.removeBarbsFilter(t)];break;case"points":t="+"==e.op?[...window.filterWindow.addPointsFilter(e,i,t)]:[...window.filterWindow.removePointsFilter(e,t)]}})),$("#copyCheck").is(":checked")){let e={...window.groups[n]};e.villages=t,e.id=(new Date).getTime(),window.groups.push(e),window.groupWindow.loadActiveGoup(e.id)}else window.groups[n].villages=t})),$(".filter-items").html(""),window.groupWindow.selectedGroups=[],window.groupWindow.renderGroupList(),window.mapMenu.renderGroupSelect(),(0,o.render)(),window.filterWindow.cancelFilter(),window.groupWindow.renderSelectedVillages()):window.UI.ErrorMessage((0,t.Lang)("no_filter_added")):window.UI.ErrorMessage((0,t.Lang)("no_group_selected"))},addPlayerFilter(e,n,i){let t=[...i];return n.forEach((n=>{n.player==e.val.id&&-1==i.findIndex((e=>e.id==n.id))&&t.push(n)})),t},removePlayerFilter(e,n){let i=[];return n.forEach((n=>{n.player!=e.val.id&&i.push(n)})),i},addAllyFilter(e,n,i){let t=[...i];return n.forEach((n=>{let o=window.players.findIndex((e=>e.id==n.player));-1!=o&&window.players[o].ally==e.val.id&&-1==i.findIndex((e=>e.id==n.id))&&t.push(n)})),console.log(t),t},removeAllyFilter(e,n){let i=[];return n.forEach((n=>{let t=window.players.findIndex((e=>e.id==n.player));t>-1&&window.players[t].ally!=e.val.id&&i.push(n)})),i},addBonusFilter(e,n,i){let t=[...i];return n.forEach((n=>{n.rank==e.val.id&&-1!=e.val.id&&t.push(n),n.rank>0&&-1==e.val.id&&t.push(n)})),t},removeBonusFilter(e,n){let i=[];return n.forEach((n=>{n.rank!=e.val.id&&-1!=e.val.id&&i.push(n),0==n.rank&&-1==e.val.id&&i.push(n)})),i},addBarbsFilter(e,n){let i=[...n];return e.forEach((e=>{0==e.player&&i.push(e)})),i},removeBarbsFilter(e){let n=[];return e.forEach((e=>{0!=e.player&&n.push(e)})),n},addPointsFilter(e,n,i){let t=[...i];return n.forEach((n=>{window.filterWindow.statement(e.val.stmt,n.points,parseInt(e.val.val.toString()))&&t.push(n)})),t},removePointsFilter(e,n){let i=[];return n.forEach((n=>{window.filterWindow.statement(e.val.stmt,n.points,parseInt(e.val.val.toString()))||i.push(n)})),i},statement(e,n,i){switch(e){case">":return n>i;case"<":return n<i;case"=":return n==i;case">=":return n>=i;case"<=":return n<=i;case"!=":return n!=i}}}},"./src/view/groupsWindow.ts":(e,n,i)=>{i.r(n),i.d(n,{groupsWindow:()=>l});var t=i("./src/core/Language.ts"),o=i("./src/core/map.ts"),r=i("./src/view/filterWindow.ts"),a=i("./src/view/importWindow.ts");function l(){return`\n <style>\n ::-webkit-scrollbar {\n width: 5px;\n }\n ::-webkit-scrollbar-track {\n box-shadow: inset 0 0 5px grey;\n border-radius: 10px;\n }\n ::-webkit-scrollbar-thumb {\n background: grey;\n border-radius: 10px;\n }\n #popup_box_groupsModal{\n width: 1200px !important;\n }\n .container {\n height:500px;\n display: grid; \n grid-template-columns: 1fr 2fr; \n grid-template-rows: 40px calc(100% - 40px); \n gap: 0px 0px; \n grid-template-areas: \n "menu menu"\n "groups villages"; \n }\n .menu { grid-area: menu; }\n .groups { grid-area: groups; text-align:center}\n .villages { grid-area: villages; text-align:center}\n .group-row { display: grid;\n grid-template-columns: 3fr 1fr 0.5fr 50px;\n grid-template-rows: 30px;\n gap: 0px 0px;\n grid-auto-flow: row;\n grid-template-areas:\n "name color checkbox view";\n }\n .group-row div{\n padding: 6px;\n }\n\n .group-items .group-row:nth-of-type(even){\n background-color: #fff5da\n }\n\n .name { grid-area: name; }\n .view { grid-area: view; }\n .color { grid-area: color; }\n .checkbox { grid-area: checkbox; }\n \n .group-items{overflow-y: scroll; height: calc(100% - 40px);}\n\n .village-row { display: grid;\n grid-template-columns:3fr 1fr 1.5fr 0.5fr 50px 35px;\n grid-template-rows: 30px;\n gap: 0px 0px;\n grid-auto-flow: row;\n grid-template-areas:\n "village-name point owner ally type goto";\n }\n\n .village-row div{\n padding: 6px;\n }\n\n .village-items .village-row:nth-of-type(even){\n background-color: #fff5da\n }\n\n .village-name {grid-area: village-name; }\n .point{grid-area: point; }\n .owner{grid-area: owner; }\n .ally{grid-area: ally; }\n .type{grid-area: type; }\n .go-to{ grid-area: goto}\n .village-items{\n overflow-y: scroll; height: calc(100% - 40px);\n }\n\n .group-header{\n margin-right:5px;\n background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);\n font-weight:bold;\n }\n\n .village-header{\n margin-right:5px;\n background: linear-gradient(to bottom,#e2c07c 0%,#dab874 44%,#c1a264 100%);\n font-weight:bold;\n }\n </style>\n <div class="container">\n <div class="menu">\n <button class="btn" onclick="groupWindow.union()">${(0,t.Lang)("union")}</button>\n <button class="btn" onclick="groupWindow.subtract()">${(0,t.Lang)("subtract")}</button>\n <button class="btn" onclick="groupWindow.section()">${(0,t.Lang)("section")}</button>\n <button class="btn" onclick="groupWindow.openImportCoords()">${(0,t.Lang)("import")}</button>\n <button class="btn" onclick="groupWindow.openFilter()">${(0,t.Lang)("filter")}</button>\n <button class="btn" onclick="groupWindow.deleteSelected()">${(0,t.Lang)("delete")}</button>\n <span>TW-mapper - v2.0 by: toldi26</span>\n <button style="float:right;" class="btn" onclick="groupWindow.copyCoords()">${(0,t.Lang)("copy")}</button>\n </div>\n <div class="groups">\n <div class="group-row group-header" >\n <div class="name">${(0,t.Lang)("name")}</div>\n <div class="color">${(0,t.Lang)("color")}</div>\n <div class="checkbox">âœ”</div>\n <div class="view">${(0,t.Lang)("view")}</div>\n </div>\n <div class="group-items"></div>\n </div>\n <div class="villages">\n <div class="village-row village-header" >\n <div class="village-name">${(0,t.Lang)("village_name")}</div>\n <div class="point">${(0,t.Lang)("points")}</div>\n <div class="owner">${(0,t.Lang)("owner")}</div>\n <div class="ally">${(0,t.Lang)("ally")}</div>\n <div class="type">${(0,t.Lang)("type")}</div>\n <div class="go-to"></div>\n </div>\n <div class="village-items"></div>\n ${(0,r.filterWindow)()}\n ${(0,a.importWindow)()}\n </div>\n </div>\n `}window.groupWindow={selectedGroups:[],renderGroupList(){let e="";window.groups.forEach((n=>{e+=`\n <div class="group-row" id="g-${n.id}">\n <div class="name">${n.name} (${n.villages.length})<a onclick="groupWindow.editGroupName(${n.id})" class="rename-icon" href="#" data-title="Ãtnevez"></a></div>\n <div class="color"><input onchange="groupWindow.changeColor(${n.id})" class="color-input" type="color" value="${n.color}"></div>\n <div class="checkbox"><input onclick="groupWindow.toggleSelected(${n.id})" type="checkbox" value="${n.id}"></div>\n <div class="view"><button onclick="groupWindow.loadActiveGoup(${n.id})" class="btn">âžœ</button></div>\n </div>\n `})),$(".group-items").html(e)},editGroupName(e){let n=window.groups.findIndex((n=>n.id==e));$("html").find(`#g-${e}`).find(".name").html(`<input value="${window.groups[n].name}" type="text"/><button class="btn" onclick="groupWindow.saveGroupName(${window.groups[n].id})" >${(0,t.Lang)("rename")}</button>`)},saveGroupName(e){let n=$("html").find(`#g-${e}`).find(".name input").val().toString().trim();if(0==n.length)return void window.UI.ErrorMessage((0,t.Lang)("group_name_req"));if(n.length>20)return void window.UI.ErrorMessage((0,t.Lang)("max_name_length"));let i=window.groups.findIndex((n=>n.id==e));window.groups[i].name=n,$("html").find(`#g-${e}`).find(".name").html(`${window.groups[i].name} (${window.groups[i].villages.length})<a onclick="groupWindow.editGroupName(${window.groups[i].id})" class="rename-icon" href="#" data-title="${(0,t.Lang)("rename")}"></a>`),window.mapMenu.renderGroupSelect()},changeColor(e){let n=window.groups.findIndex((n=>n.id==e));window.groups[n].color=$("html").find(`#g-${e}`).find(".color input").val().toString(),(0,o.render)()},loadActiveGoup(e){let n=window.groups.findIndex((n=>n.id==e));window.activeGroup=window.groups[n],window.groupWindow.renderSelectedVillages(),window.mapMenu.renderGroupSelect()},renderSelectedVillages(){let e="";window.activeGroup.villages.forEach((n=>{let i=null,t=null,o=window.players.findIndex((e=>e.id==n.player));if(o>-1){i=window.players[o];let e=window.allies.findIndex((e=>e.id==i.ally));e>-1&&(t=window.allies[e])}e+=`\n <div class="village-row">\n <div class="village-name"><a target="_blank" href="/game.php?village=${window.game_data.village.id}&screen=info_village&id=${n.id}">${n.name} (${n.x}|${n.y})</a></div>\n <div class="point">${n.points}</div>\n <div class="owner">${null!=i?`<a target="_blank" href="/game.php?village=${window.game_data.village.id}&screen=info_player&id=${i.id}">${i.name}</a>`:""}</div>\n <div class="ally">${null!=t?`<a target="_blank" href="/game.php?village=${window.game_data.village.id}&screen=info_ally&id=${t.id}">${t.tag}</a>`:""}</div>\n <div class="type">${n.rank>0?`<span class="bonus_icon bonus_icon_${n.rank}" />`:""}</div>\n <div class="go-to" onclick="groupWindow.goTo(${n.x},${n.y})"><button class="btn">ðŸŽ¯</button></div>\n </div>\n `})),$(".village-items").html(e)},toggleSelected(e){let n=window.groupWindow.selectedGroups.findIndex((n=>n==e));-1!=n?window.groupWindow.selectedGroups.splice(n,1):window.groupWindow.selectedGroups.push(e)},deleteSelected(){0!=window.groupWindow.selectedGroups.length?(window.groupWindow.selectedGroups.forEach((e=>{let n=window.groups.findIndex((n=>n.id==e));window.groups.splice(n,1)})),window.groupWindow.selectedGroups=[],window.mapMenu.renderGroupSelect(),window.groupWindow.renderGroupList()):window.UI.ErrorMessage((0,t.Lang)("no_group_selected"))},union(){if(window.groupWindow.selectedGroups.length<2)return void window.top.UI.ErrorMessage((0,t.Lang)("not_enough_group_selected"));let e=window.groups.findIndex((e=>e.id==window.groupWindow.selectedGroups[0])),n=[...window.groups[e].villages],i=window.groups[e].name;for(let e=1;e<window.groupWindow.selectedGroups.length;e++){let t=window.groups.findIndex((n=>n.id==window.groupWindow.selectedGroups[e])),o=[...window.groups[t].villages];i+=" âˆª "+window.groups[t].name,o.forEach((e=>{-1==n.findIndex((n=>e.x==n.x&&e.y==n.y))&&n.push(e)}))}window.groups.push({id:(new Date).getTime(),name:i,color:window.groups[e].color,villages:n}),window.groupWindow.selectedGroups=[],window.mapMenu.renderGroupSelect(),window.groupWindow.renderGroupList(),(0,o.render)()},subtract(){if(window.groupWindow.selectedGroups.length<2)return void window.top.UI.ErrorMessage((0,t.Lang)("no_group_selected"));let e=window.groups.findIndex((e=>e.id==window.groupWindow.selectedGroups[0])),n=[...window.groups[e].villages],i=window.groups[e].name;for(let e=1;e<window.groupWindow.selectedGroups.length;e++){let t=window.groups.findIndex((n=>n.id==window.groupWindow.selectedGroups[e])),o=[...window.groups[t].villages];i+=" - "+window.groups[t].name,o.forEach((e=>{let i=n.findIndex((n=>e.x==n.x&&e.y==n.y));-1!=i&&n.splice(i,1)}))}window.groups.push({id:(new Date).getTime(),name:i,color:window.groups[e].color,villages:n}),window.groupWindow.selectedGroups=[],window.mapMenu.renderGroupSelect(),window.groupWindow.renderGroupList(),(0,o.render)()},section(){if(window.groupWindow.selectedGroups.length<2)return void window.top.UI.ErrorMessage((0,t.Lang)("no_group_selected"));let e=window.groups.findIndex((e=>e.id==window.groupWindow.selectedGroups[0])),n=[...window.groups[e].villages],i=window.groups[e].name;for(let e=1;e<window.groupWindow.selectedGroups.length;e++){let t=window.groups.findIndex((n=>n.id==window.groupWindow.selectedGroups[e])),o=[...window.groups[t].villages],r=[];i+=" âˆ© "+window.groups[t].name,n.forEach((e=>{-1!=o.findIndex((n=>n.x==e.x&&n.y==e.y))&&r.push(e)})),n=r}window.groups.push({id:(new Date).getTime(),name:i,color:window.groups[e].color,villages:n}),window.groupWindow.selectedGroups=[],window.mapMenu.renderGroupSelect(),window.groupWindow.renderGroupList(),(0,o.render)()},copyCoords(){window.activeGroup?0!=window.activeGroup.villages.length?(window.UI.SuccessMessage((0,t.Lang)("copied_to_clipboard")),navigator.clipboard.writeText(window.activeGroup.villages.map((e=>e.x+"|"+e.y)).join(" "))):window.UI.ErrorMessage((0,t.Lang)("empty_group")):window.UI.ErrorMessage((0,t.Lang)("no_group_selected"))},openFilter(){window.filterWindow.filters=[],0!=window.groupWindow.selectedGroups.length?($(".filter-window").show(),$(".group-items").find('input[type="checkbox"]').get().forEach((e=>{$(e).prop("disabled")||$(e).prop("disabled",!0)}))):window.UI.ErrorMessage((0,t.Lang)("no_group_selected"))},openImportCoords(){if(0==window.groupWindow.selectedGroups.length)return void window.UI.ErrorMessage((0,t.Lang)("no_group_selected"));if(window.groupWindow.selectedGroups.length>1)return void window.UI.ErrorMessage((0,t.Lang)("only_one"));let e=window.groupWindow.selectedGroups[0],n=window.groups.findIndex((n=>n.id==e));$(".import-window").show(),$("#importTextarea").val(""),$("#importGroupName").text(window.groups[n].name),$(".group-items").find('input[type="checkbox"]').get().forEach((e=>{$(e).prop("disabled")||$(e).prop("disabled",!0)}))},goTo(e,n){window.Dialog.close("groupsModal"),$("#mapx").val(e.toString()),$("#mapy").val(n.toString()),window.TWMap.focusSubmit()}}},"./src/view/importWindow.ts":(e,n,i)=>{i.r(n),i.d(n,{importWindow:()=>r});var t=i("./src/core/Language.ts"),o=i("./src/core/map.ts");function r(){return`\n <style>\n .import-window{\n width:500px;\n height: max-content;\n position:fixed;\n top: 0;\n bottom: 0;\n left: 0;\n right: 0;\n margin: auto;\n background-color:#f4e4bc;\n background: transparent url(https://dshu.innogamescdn.com/asset/fd86cac8/graphic/index/contentbg.png) scroll left top repeat;\n filter: drop-shadow(0 0 0.75rem rgb(88, 88, 88));\n border: 2px solid #6c4824;\n border-radius: 10px;\n display:grid;\n padding:5px;\n row-gap:10px;\n }\n textarea {\n resize: none;\n height:200px;\n width:calc(100% - 10px);\n }\n .import-header{\n text-align: center;\n background: linear-gradient(to bottom, #e2c07c 0%, #dab874 44%, #c1a264 100%);\n height:20px;\n border-radius:5px;\n }\n </style>\n <div class="import-window" style="display:none;">\n <div class="import-header">\n <h4>${(0,t.Lang)("import_coords")} "<span id="importGroupName"></span>" ${(0,t.Lang)("into_group")}</h4>\n </div>\n <div>${(0,t.Lang)("valid_coorsd")}: <span id="validCoords">0</span></div>\n <textarea onkeyup="importWindow.textareaChanged(event)" id="importTextarea"></textarea>\n <div class="import-footer">\n <button id="cancelBtn" class="btn" onclick="importWindow.importCoords()">${(0,t.Lang)("apply")}</button>\n <button id="applyBtn" class="btn" onclick="importWindow.cancelImport()">${(0,t.Lang)("cancel")}</button> \n </div>\n </div>\n `}window.importWindow={to:null,importVillages:[],cancelImport(){$(".import-window").hide(),window.filterWindow.filters=[],$(".group-items").find('input[type="checkbox"]').get().forEach((e=>{$(e).prop("disabled")&&$(e).prop("disabled",!1)}))},importCoords(){let e=window.groupWindow.selectedGroups[0],n=window.groups.findIndex((n=>n.id==e));window.importWindow.importVillages.forEach((e=>{-1==window.groups[n].villages.findIndex((n=>n.id==e.id))&&window.groups[n].villages.push(e)})),window.importWindow.cancelImport(),window.groupWindow.selectedGroups=[],window.groupWindow.renderGroupList(),window.mapMenu.renderGroupSelect(),(0,o.render)(),window.groupWindow.renderSelectedVillages()},textareaChanged(e){e.preventDefault(),e.stopPropagation(),clearTimeout(window.importWindow.to),window.importWindow.to=setTimeout((()=>{window.importWindow.importVillages=[],$("#validCoords").html('<img style="height:15px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">BetÃ¶ltÃ©s...</span>');let e=$("#importTextarea").val().toString();$("#importTextarea").prop("disabled",!0),$("#applyBtn").prop("disabled",!0),$("#cancelBtn").prop("disabled",!0),setTimeout((()=>{Array.from(e.matchAll(/([0-9]{1,3}).([0-9]{1,3})/g)).forEach((e=>{let n=e[1]+"|"+e[2],i=window.villages.find((e=>`${e.x}|${e.y}`==n)),t=window.importWindow.importVillages.findIndex((e=>`${e.x}|${e.y}`==n));i&&-1==t&&window.importWindow.importVillages.push(i)})),$("#validCoords").html(window.importWindow.importVillages.length.toString()),$("#importTextarea").prop("disabled",!1),$("#applyBtn").prop("disabled",!1),$("#cancelBtn").prop("disabled",!1),$("#importTextarea").focus()}),100)}),1e3)}}},"./src/view/language/en.ts":(e,n,i)=>{i.r(n),i.d(n,{en:()=>t});const t={map_loaded:"Map data loaded!",api_updated:"Api updated",updating_map_data:"Updating map data",redirect_to_map:"Redirecting to the map!",groups:"Groups",new_group:"New Group",update_api:"Update Data",api_last_update:"Api updated",choose_group:"-- Choose a group --",color:"Color",name:"Name",add:"Add",cancel:"Cancel",draw:"Drawing",village_info:"Village info",concave:"Concave",circle:"Circle",single:"Single",reset:"Reset",group_name_req:"The name of the group must be entered!",union:"Union",subtract:"Subtract",section:"Section",filter:"Filter",delete:"Delete",copy:"Copy",carbon_copy:"Carbon Copy",groupe_name:"Group Name",select:"choose",view:"View",village_name:"Village Name",loading:"loading",villages:"Villages",players:"Players",allies:"Allies",points:"Points",owner:"Owner",ally:"Tribe",type:"Type",barb:"Barb",player:"Player",bonus:"Bonus",apply:"Apply",rename:"Rename",no_group_selected:"No group is selected!",no_group:"No group has been created!",empty_group:"The selected group is empty!",not_enough_group_selected:"Not enough groups selected",only_barbs:"Bonus Only",not_bonus:"Not bonus",village_points:"Village Points",filter_must_be_entered:"The filtering value must be entered!",remove_it:"remove",add_it:"add",remove:"Remove",if_village_points:"if village points",no_filter_added:"No filter added!",copied_to_clipboard:"The coordinates were successfully copied to the clipboard!",barbs:"Barbs",no_villages_in_group:"There are no villages in the group!",max_name_length:"The group name can be a maximum of 20 characters",import:"Import",into_group:"group",import_coords:"Import coords into",valid_coorsd:"Valid coords",only_one:"You can only import into one group!"}},"./src/view/language/hu.ts":(e,n,i)=>{i.r(n),i.d(n,{hu:()=>t});const t={map_loaded:"TÃ©rkÃ©p adatok betÃ¶ltve!",api_updated:"Api frissÃ­tve",updating_map_data:"TÃ©rkÃ©p adatok frissÃ­tÃ©se",redirect_to_map:"ÃtÃ­rÃ¡nyÃ­tÃ¡s a tÃ©rkÃ©pre!",groups:"Csoportok",new_group:"Ãšj csoport",update_api:"Adatok frissÃ­tÃ©se",api_last_update:"Api frissÃ­tve",choose_group:"-- VÃ¡lassz csoportot --",color:"SzÃ­n",name:"NÃ©v",add:"HozzÃ¡ad",cancel:"MÃ©gse",draw:"RajzolÃ¡s",village_info:"Falu info",concave:"KonkÃ¡v",circle:"KÃ¶r",single:"EgyenkÃ©nt",reset:"VisszaÃ¡llÃ­t",group_name_req:"A csoport nevÃ©t kÃ¶telezÅ‘ megadni!",union:"Ã–sszevon",subtract:"Kivon",section:"Metszet",filter:"SzÅ±rÃ©s",delete:"TÃ¶rlÃ©s",copy:"MÃ¡solÃ¡s",carbon_copy:"MÃ¡solat",groupe_name:"Csoport NÃ©v",select:"vÃ¡laszt",view:"NÃ©zet",village_name:"Falu NÃ©v",loading:"beltÃ¶ltÃ©se",villages:"Falvak",players:"JÃ¡tÃ©kosok",allies:"KlÃ¡nok",points:"Pontok",owner:"Tulajdonos",ally:"KlÃ¡n",type:"TÃ­pus",barb:"BarbÃ¡r",player:"JÃ¡tÃ©kos",bonus:"BÃ³nusz",apply:"Alkalmaz",rename:"Ãtnevez",no_group_selected:"Nincs egy csoport se kivÃ¡lasztva!",no_group:"Nincs egy csoport se lÃ©trehozva!",empty_group:"Nincs egy csoportban egy falu sem!",not_enough_group_selected:"Nincs elegendÅ‘ csoport kivÃ¡lasztva",only_barbs:"Csak bÃ³nusz",not_bonus:"Nem bÃ³nusz",village_points:"Falu pontok",filter_must_be_entered:"A szÅ±rÃ©si Ã©rtÃ©ket kÃ¶telezÅ‘ megadni!",remove_it:"eltÃ¡volÃ­tÃ¡sa",add_it:"hozzÃ¡adÃ¡sa",remove:"EltÃ¡volÃ­tÃ¡s",if_village_points:"ha falu pontok",no_filter_added:"Nincs egy szÅ±rÅ‘ se hozzÃ¡adva!",copied_to_clipboard:"A koordinÃ¡tÃ¡k sikeresen vÃ¡gÃ³lapra lettek mÃ¡solva!",barbs:"BarbÃ¡rok",max_name_length:"A csoport neve max 20 karakter lehet!",import:"ImportÃ¡lÃ¡s",into_group:"csoportba",import_coords:"KoordinÃ¡tÃ¡k importÃ¡lÃ¡sa",valid_coorsd:"Valid koordinÃ¡tÃ¡k",only_one:"Csak egy csoportba lehet importÃ¡lni!"}},"./src/view/loadingWindow.ts":(e,n,i)=>{i.r(n),i.d(n,{loadingWindow:()=>o});var t=i("./src/core/Language.ts");function o(){return`\n <h1 style="text-align:center">${(0,t.Lang)("updating_map_data")}</h1>\n <div style="width:250px; display:block; margin:0 auto;" class="progress-bar progress-bar-alive">\n <span class="label mapper-loader-label"></span>\n <div id="mapper-loader-pct" style="width: 0%">\n <span class="label mapper-loader-label" style="width:250px"></span>\n </div>\n </div>\n <div id="mapper-loading" style="display: flex; justify-content: center; width: 100%;">\n <img style="height:25px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">${(0,t.Lang)("loading")}...</span>\n </div>\n `}},"./src/view/mapMenu.ts":(e,n,i)=>{i.r(n),i.d(n,{mapMenu:()=>g});var t=i("./src/core/Language.ts"),o=i("./src/img/circle.ts"),r=i("./src/img/kontinent.ts"),a=i("./src/img/line.ts"),l=i("./src/img/rectangle.ts"),s=i("./src/img/single.ts"),d=i("./src/img/tape.ts"),c=i("./src/core/api.ts"),w=i("./src/core/map.ts"),p=i("./src/view/groupsWindow.ts");function g(){return`\n <style>\n .tool{\n background-color:#c1a264;\n border-radius:5px;\n padding:4px;\n box-shadow:2px 3px 4px 0px #e4c588;\n cursor:pointer;\n }\n\n .tool:hover{\n background-color: #facc71 !important;\n }\n .tool-selected{\n box-shadow:inset 2px 3px 4px 0px #5e5e5ea6 !important;\n background-color: #facc71 !important;\n }\n .tool-bar{\n margin-top:10px;\n display:flex;\n justify-content:start;\n gap: 5px;\n }\n\n .tool-bar label{\n margin-top:3px;\n }\n .tool-bar select{\n font-size:14px; width:100px\n }\n .color-input{\n height:21px\n }\n .api-update-btn{\n float:right;margin-top:5px;\n }\n .update-div{\n float:right;\n }\n .update-div span{\n float:right;\n }\n </style>\n <div id="mapMenu">\n <div class="update-div" >\n <span id="updated">${(0,t.Lang)("api_last_update")}: ${(0,c.getLastUpdate)()}</span><br>\n <button class="btn api-update-btn" onclick="mapMenu.updateApi()">${(0,t.Lang)("update_api")}</button>\n </div>\n <div class="tool-bar" style="display:none;" id="addGroup">\n <label for="color">${(0,t.Lang)("color")}:</label>\n <input type="color" class="color-input" id="color" value="#e66465" />\n <label for="groupName">${(0,t.Lang)("name")}:</label>\n <input type="text" id="groupName" />\n <button class="btn" onclick="mapMenu.addNewGroup()">${(0,t.Lang)("add")}</button>\n <button class="btn" onclick="mapMenu.cancelNewGroupModal()">${(0,t.Lang)("cancel")}</button>\n </div>\n <div class="tool-bar" id="mapControls">\n <button class="btn" onclick="mapMenu.openGroups()">${(0,t.Lang)("groups")}</button>\n <button class="btn" onclick="mapMenu.newGroupModal()">${(0,t.Lang)("new_group")}</button>\n <input type="checkbox" onchange="mapMenu.toggleDrawing()" id="draw" >\n <label for="draw">${(0,t.Lang)("draw")}</label>\n <input type="checkbox" onchange="mapMenu.toggleInfo()" id="vinfo" checked>\n <label for="vinfo">${(0,t.Lang)("village_info")}</label>\n </div>\n <div class="tool-bar">\n <select onchange="mapMenu.groupChanged()" id="groupSelector" placeholder="${(0,t.Lang)("choose_group")}"></select>\n <button class="btn" onclick="mapMenu.addToGroup()">${(0,t.Lang)("add")}</button>\n <button class="btn" onclick="mapMenu.resetMarkers()">${(0,t.Lang)("reset")}</button>\n </div>\n <div class="tool-bar">\n <div class="tool" onclick="mapMenu.selectTool('circle',this)">\n ${(0,o.circle)()}\n </div>\n <div class="tool" onclick="mapMenu.selectTool('concave',this)">\n ${(0,a.line)()}\n </div>\n <div class="tool" onclick="mapMenu.selectTool('rectangle',this)">\n ${(0,l.rectangle)()}\n </div>\n <div class="tool" onclick="mapMenu.selectTool('single',this)">\n ${(0,s.single)()}\n </div>\n <div class="tool" onclick="mapMenu.selectTool('kontinent',this)">\n ${(0,r.kontinent)()}\n </div>\n <div class="tool" onclick="mapMenu.selectTool('tape',this)">\n ${(0,d.tape)()}\n </div>\n </div>\n\n </div>\n `}window.mapMenu={isDrawing:!1,selectedTool:"",groupChanged(){if(""==$("#groupSelector").val())return void $("#tools").hide();$("#tools").show();let e=parseInt($("#groupSelector").val().toString()),n=window.groups.findIndex((n=>n.id==e));window.activeGroup=window.groups[n],window.mapMenu.renderGroupSelect()},resetMarkers(){window.markers=[],(0,w.render)()},addToGroup(){if(0==window.groups.length)return void window.UI.ErrorMessage((0,t.Lang)("no_group"));let e=window.groups.findIndex((e=>e.id==window.activeGroup.id));window.markers.forEach((n=>{n.villages.forEach((n=>{-1==window.groups[e].villages.findIndex((e=>e.id==n.id))&&window.groups[e].villages.push(n)}))})),window.markers=[],(0,w.render)(),window.mapMenu.renderGroupSelect()},selectTool(e,n){$(".tool-bar .tool").removeClass("tool-selected"),$(n).addClass("tool-selected"),$("#inputBar").html(""),window.mapMenu.selectedTool=e},async updateApi(){await(0,c.update)(),$("#updated").text(`${(0,t.Lang)("api_last_update")}: ${(0,c.getLastUpdate)()}`)},newGroupModal(){$("#mapControls").hide(),$("#addGroup").show()},cancelNewGroupModal(){$("#mapControls").show(),$("#addGroup").hide()},addNewGroup(){let e=$("#groupName").val().toString(),n=$("#color").val().toString();if(""==e)return void window.UI.ErrorMessage((0,t.Lang)("group_name_req"));if(e.length>20)return void window.UI.ErrorMessage((0,t.Lang)("max_name_length"));$("#mapControls").show(),$("#addGroup").hide();let i={id:(new Date).getTime(),name:e,color:n,villages:[]};window.groups.push(i),window.activeGroup=i,window.mapMenu.renderGroupSelect(),$("#groupName").val("")},renderGroupSelect(){let e="";window.groups.forEach((n=>{e+=`<option ${n.id==window.activeGroup.id&&"selected"} value="${n.id}">${n.name} (${n.villages.length})</option>`})),$("#groupSelector").html(e)},toggleDrawing(){window.mapMenu.isDrawing?(window.mapMenu.isDrawing=!1,window.TWMap.map._handleClick=window.backupTW,$("#map_popup").css("opacity","1")):(window.mapMenu.isDrawing=!0,window.TWMap.map._handleClick=w.mapAction)},toggleInfo(){$("#vinfo").is(":checked")?$("#map_popup").css("opacity","1"):$("#map_popup").css("opacity","0")},openGroups(){window.Dialog.show("groupsModal",(0,p.groupsWindow)()),window.groupWindow.renderGroupList(),window.groupWindow.renderSelectedVillages()}}}},n={};function i(t){var o=n[t];if(void 0!==o)return o.exports;var r=n[t]={exports:{}};return e[t](r,r.exports,i),r.exports}i.d=(e,n)=>{for(var t in n)i.o(n,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},i.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.r({});var t=i("./src/core/Language.ts"),o=i("./src/core/api.ts"),r=i("./src/core/indexedDBHandler.ts"),a=i("./src/core/map.ts"),l=i("./src/view/mapMenu.ts");(async()=>{(0,o.redirect)()||(window.groups=[],window.markers=[],window.Lang=(0,t.determineLang)(),window.gameConfig=await(0,o.getServerConfig)(),window.unitConfig=await(0,o.getUnitConfig)(),(0,a.initMap)(),window.DB=await r.indexedDBHandler.init("TW_API_DATA",[{name:"villages",keyName:"id",AI:!1},{name:"players",keyName:"id",AI:!1},{name:"allies",keyName:"id",AI:!1}],1),await(0,o.updateWorldData)(),window.villages=await window.DB.getAllData("villages"),window.players=await window.DB.getAllData("players"),window.allies=await window.DB.getAllData("allies"),0==$("#mapMenu").length&&$("#content_value h2").after((0,l.mapMenu)()))})()})();