/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/core/Language.ts":(e,t,a)=>{a.r(t),a.d(t,{Lang:()=>s,determineLang:()=>r});var n=a("./src/view/language/en.ts"),o=a("./src/view/language/hu.ts");function s(e){let t=o.hu;switch(window.Lang){case"hu":t=o.hu;break;case"en":t=n.en}return t.hasOwnProperty(e)?t[e]:`lang.${window.Lang}.${e}`}function r(){const e=navigator.language.split("-")[0];return["hu","en"].includes(e)?e:"en"}},"./src/core/api.ts":(e,t,a)=>{a.r(t),a.d(t,{updateWorldData:()=>i});var n=a("./src/view/loadingWindow.ts");async function o(e,t,a){console.log("started "+t);let n=e.trim().split("\n");await s(n,0,t,a),console.log("finished outer"+t)}async function s(e,t,a,n){return new Promise((async(o,r)=>{let i=function(e,t){let a=e.split(","),n={};return a.forEach(((e,a)=>{let o=decodeURIComponent(e).replaceAll("+"," ");isNaN(o)||(o=parseInt(o)),n[t[a]]=o})),n}(e[t],n);await window.DB.setData(a,i);let l=Math.ceil((t+1)/e.length*100);$("html").find(".mapper-loader-label").text(`${l}%`),$("html").find("#mapper-loader-pct").css("width",`${l}%`),$("html").find("#mapper-loading span").text(`${a} bet√∂lt√©se...`),t++,console.log(t,e.length,t<e.length),t<e.length&&await s(e,t,a,n),o("done")}))}function r(e){return $.ajax({url:e,type:"GET"})}async function i(){parseInt(localStorage.getItem("TW_API_LAST_UPDATE"))>(new Date).getTime()||await async function(){console.log("Updating..."),window.Dialog.show("launchDialog",(0,n.loadingWindow)()),$(".popup_box_close").hide(),$(".popup_box_container").append('<div style="position: fixed;width: 100%;height: 100%;top:0;left:0;z-index:12001"></div>');let e=await r(`https://${window.location.host}/map/village.txt`),t=await r(`https://${window.location.host}/map/player.txt`),a=await r(`https://${window.location.host}/map/ally.txt`);await o(e,"villages",["id","name","x","y","player","points","rank"]),await l(1e3),await o(t,"players",["id","name","ally","villages","points","rank"]),await l(1e3),await o(a,"allies",["id","name","tag","members","villages","points","all_points","rank"]),await l(1e3),console.log("Updated allies"),localStorage.setItem("TW_API_LAST_UPDATE",new Date((new Date).setDate((new Date).getDate()+1)).getTime().toString()),$("html").find("#mapper-loading span").text("A bet√∂lt√©s befejez≈ëd√∂tt"),setTimeout((()=>{window.Dialog.close("launchDialog")}),2e3)}()}async function l(e){return new Promise((async(t,a)=>{setTimeout((()=>{t()}),e)}))}},"./src/core/indexedDBHandler.ts":(e,t,a)=>{a.r(t),a.d(t,{indexedDBHandler:()=>n});class n{constructor(e,t,a,n){this.db=e,this.dbName=t,this.stores=a,this.version=n,console.log(`loaded ${this.dbName} DB üöÄ`)}static async init(e,t,a){return new Promise(((o,s)=>{let r=indexedDB.open(e,a);r.onupgradeneeded=()=>{t.forEach((e=>{r.result.objectStoreNames.contains(e.keyName)||r.result.createObjectStore(e.name,{keyPath:e.keyName,autoIncrement:e.AI})})),r.onsuccess=()=>{o(new n(r.result,e,t,a))}},r.onsuccess=()=>{o(new n(r.result,e,t,a))},r.onerror=()=>{throw console.error("Error",r.error),new Error(r.error.message)}}))}getTransaction(e){let t=this.stores.findIndex((t=>t.name==e));return-1==t?null:(this.stores[t].transaction||(this.stores[t].transaction=this.db.transaction(e,"readwrite")),this.stores[t].transaction)}async getAllData(e){return new Promise((async(t,a)=>{if(!this.db.objectStoreNames.contains(e))return void t([]);let n=this.getTransaction(e),o=await n.objectStore(e).getAll();o.onsuccess=()=>{t(o.result)}}))}async getData(e,t){return new Promise((async(a,n)=>{if(!this.db.objectStoreNames.contains(e))return void a(null);let o=this.getTransaction(e),s=await o.objectStore(e).get(t);s.onsuccess=()=>{s.result?a(s.result):a(null)}}))}async setData(e,t){return new Promise((async(a,n)=>{if(!this.db.objectStoreNames.contains(e))return void a(null);let o=this.getTransaction(e),s=await o.objectStore(e).put(t);s.onsuccess=()=>{a(s.result)}}))}async removeData(e,t){return new Promise((async(a,n)=>{if(!this.db.objectStoreNames.contains(e))return void a(null);let o=this.getTransaction(e),s=await o.objectStore(e).delete(t);s.onsuccess=()=>{a(s.result)}}))}}},"./src/view/language/en.ts":(e,t,a)=>{a.r(t),a.d(t,{en:()=>n});const n={map_loaded:"Map data loaded!",api_updated:"Api updated",updating_map_data:"Updating map data",redirect_to_map:"Redirecting to the map!",groups:"Groups",new_group:"New Group",update_api:"Update Data",api_last_update:"Api updated",choose_group:"-- Choose a group --",color:"Color",name:"Name",add:"Add",cancel:"Cancel",draw:"Drawing",village_info:"Village info",concave:"Concave",circle:"Circle",single:"Single",reset:"Reset",group_name_req:"The name of the group must be entered!",union:"Union",subtract:"Subtract",section:"Section",filter:"Filter",delete:"Delete",copy:"Copy",carbon_copy:"Carbon Copy",groupe_name:"Group Name",select:"choose",view:"View",village_name:"Village Name",points:"Points",owner:"Owner",ally:"Tribe",type:"Type",barb:"Barb",player:"Player",bonus:"Bonus",apply:"Apply",rename:"Rename",no_group_selected:"No group is selected!",not_enough_group_selected:"Not enough groups selected",only_barbs:"Bonus Only",not_bonus:"Not bonus",village_points:"Village Points",filter_must_be_entered:"The filtering value must be entered!",remove_it:"remove",add_it:"add",remove:"Remove",if_village_points:"if village points",no_filter_added:"No filter added!",copied_to_clipboard:"The coordinates were successfully copied to the clipboard!",barbs:"Barbs",no_villages_in_group:"There are no villages in the group!",max_name_length:"The group name can be a maximum of 20 characters"}},"./src/view/language/hu.ts":(e,t,a)=>{a.r(t),a.d(t,{hu:()=>n});const n={map_loaded:"T√©rk√©p adatok bet√∂ltve!",api_updated:"Api friss√≠tve",updating_map_data:"T√©rk√©p adatok friss√≠t√©se",redirect_to_map:"√Åt√≠r√°ny√≠t√°s a t√©rk√©pre!",groups:"Csoportok",new_group:"√öj csoport",update_api:"Adatok friss√≠t√©se",api_last_update:"Api friss√≠tve",choose_group:"-- V√°lassz csoportot --",color:"Sz√≠n",name:"N√©v",add:"Hozz√°ad",cancel:"M√©gse",draw:"Rajzol√°s",village_info:"Falu info",concave:"Konk√°v",circle:"K√∂r",single:"Egyenk√©nt",reset:"Vissza√°ll√≠t",group_name_req:"A csoport nev√©t k√∂telez≈ë megadni!",union:"√ñsszevon",subtract:"Kivon",section:"Metszet",filter:"Sz≈±r√©s",delete:"T√∂rl√©s",copy:"M√°sol√°s",carbon_copy:"M√°solat",groupe_name:"Csoport N√©v",select:"v√°laszt",view:"N√©zet",village_name:"Falu N√©v",points:"Pontok",owner:"Tulajdonos",ally:"Kl√°n",type:"T√≠pus",barb:"Barb√°r",player:"J√°t√©kos",bonus:"B√≥nusz",apply:"Alkalmaz",rename:"√Åtnevez",no_group_selected:"Nincs egy csoport se kiv√°lasztva!",not_enough_group_selected:"Nincs elegend≈ë csoport kiv√°lasztva",only_barbs:"Csak b√≥nusz",not_bonus:"Nem b√≥nusz",village_points:"Falu pontok",filter_must_be_entered:"A sz≈±r√©si √©rt√©ket k√∂telez≈ë megadni!",remove_it:"elt√°vol√≠t√°sa",add_it:"hozz√°ad√°sa",remove:"Elt√°vol√≠t√°s",if_village_points:"ha falu pontok",no_filter_added:"Nincs egy sz≈±r≈ë se hozz√°adva!",copied_to_clipboard:"A koordin√°t√°k sikeresen v√°g√≥lapra lettek m√°solva!",barbs:"Barb√°rok",max_name_length:"A csoport neve max 20 karakter lehet!"}},"./src/view/loadingWindow.ts":(e,t,a)=>{a.r(t),a.d(t,{loadingWindow:()=>o});var n=a("./src/core/Language.ts");function o(){return`\n        <h1 style="text-align:center">${(0,n.Lang)("updating_map_data")}</h1>\n        <div style="width:250px; display:block; margin:0 auto;" class="progress-bar progress-bar-alive">\n            <span  class="label mapper-loader-label"></span>\n            <div id="mapper-loader-pct" style="width: 0%">\n                <span class="label  mapper-loader-label" style="width:250px"></span>\n            </div>\n        </div>\n        <div id="mapper-loading" style="display: flex; justify-content: center; width: 100%;">\n            <img style="height:25px" src="https://dshu.innogamescdn.com/asset/6389cdba/graphic/loading.gif"><span style="padding:5px">Bet√∂lt√©s...</span>\n        </div>\n    `}}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.r({});var n=a("./src/core/Language.ts"),o=a("./src/core/api.ts"),s=a("./src/core/indexedDBHandler.ts");(async()=>{window.Lang=(0,n.determineLang)(),window.DB=await s.indexedDBHandler.init("TW_API_DATA",[{name:"villages",keyName:"id",AI:!1},{name:"players",keyName:"id",AI:!1},{name:"allies",keyName:"id",AI:!1}],1),(0,o.updateWorldData)()})()})();